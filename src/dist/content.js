(()=>{"use strict";var e={variables:{DeadZone:.2},keymapping:{buttons:{1:{action:"seekForward",params:{seconds:5}},2:{action:"seekForward",params:{seconds:-1}},7:{action:"setSpeed"},10:{action:"fullscreenToggle"},11:{action:"pauseOrPlay"},14:{action:"seekForward",params:{seconds:-5}}}}},t=Object.freeze({button:"button",axis:"axis"});function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,s(a.key),a)}}function r(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}var i=e;chrome.storage.sync.get({config:e},function(e){i=e.config}),chrome.storage.onChanged.addListener(function(e,t){"sync"===t&&e.config&&(i=e.config.newValue)}),Object.freeze({EnableListening:"enableListening",DisableListening:"disableListening",KeyPressed:"keyPressed",GetSpeed:"getSpeed",SetSpeed:"setSpeed",SeekForward:"seekForward",PauseOrPlay:"pauseOrPlay",FullscreenToggle:"fullscreenToggle"});var l=new(function(){return r(function e(t){a(this,e),this.toast=t},[{key:"getSpeed",value:function(){var e=document.querySelector("video");return e?e.playbackRate:(console.log("No video element found on the page."),null)}},{key:"setSpeed",value:function(e){if(this.getSpeed()!==e){var t=document.querySelector("video");t?t.playbackRate=e:console.log("No video element found on the page."),this.toast.setContent("Speed: ".concat(Math.floor(100*this.getSpeed())/100))}}},{key:"seekForward",value:function(e){var t=document.querySelector("video");t?(t.currentTime+=e,e>0?this.toast.setContent(">> ".concat(e,"s")):this.toast.setContent("<< ".concat(e,"s"))):console.log("No video element found on the page.")}},{key:"pauseOrPlay",value:function(){var e=document.querySelector("video");e.paused?e.play():e.pause()}},{key:"fullscreenToggle",value:function(){var e=document.querySelector("video");e?document.fullscreenElement?document.exitFullscreen():e.requestFullscreen():console.log("No video element found on the page.")}}])}())(new(function(){return r(function e(){if(a(this,e),this.start=0,this.toast=document.getElementById("toast"),null==this.toast){console.log("Creating toast element...");var t=document.createElement("style");t.textContent="\n#toast {\n  visibility: hidden;\n  opacity: 0.5;\n  z-index: 9999;\n  min-width: 250px;\n  margin-left: -125px;\n  background-color: #333;\n  color: #fff;\n  text-align: center;\n  border-radius: 2px;\n  padding: 16px;\n  position: fixed;\n  left: 50%;\n  bottom: 30px;\n  font-size: 17px;\n}\n\n#toast.show {\n  visibility: visible;\n  display: block;\n  -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;\n  animation: fadein 0.5s, fadeout 0.5s 2.5s;\n}\n            ",document.head.appendChild(t),this.toast=document.createElement("div"),this.toast.id="toast",document.body.appendChild(this.toast)}},[{key:"setContent",value:function(e){var t=this;this.start=(new Date).getTime(),this.toast.className="show",this.toast.textContent=e,setTimeout(function(){t.start+3e3<=(new Date).getTime()&&(t.toast.className=t.toast.className.replace("show",""))},3e3)}}])}())),u={pressed:!1,ts:0,restored:!0};function c(){var e=navigator.getGamepads();if(e&&0!==e.length){var n=e[0];if(n){var a=function(e,n,a){var o=function(e,n){for(var a=n&&n.variables&&n.variables.DeadZone?n.variables.DeadZone:.2,o=null,r=null,s=null,i=0;i<e.axes.length;i++)if(e.axes[i].value>a){o=t.axis,r=i,s=(e.axes[i].value-a)/(1-a);break}for(var l=0;l<e.buttons.length;l++)if(e.buttons[l].value>a){o=t.button,r=l,s=(e.buttons[l].value-a)/(1-a);break}return null===r?null:{type:o,idx:r,val:s}}(e,n);if(null==o)return a.restored?null:(a.restored=!0,{action:"setSpeed",params:{speed:1}});if(null===o.val)return null;a.restored=!1;var r=Math.floor(100*o.val)/100;if(n&&n.keymapping){var s=n.keymapping.buttons[o.idx];if(s)switch(s.action){case"seekForward":if(s.params)return{action:"seekForward",params:s.params};break;case"setSpeed":return{action:"setSpeed",params:{speed:s.params&&void 0!==s.params.speed?s.params.speed:r<=.5?1+2*r:2+4*(r-.5)}};case"fullscreenToggle":return{action:"fullscreenToggle"};case"pauseOrPlay":return{action:"pauseOrPlay"}}}}(n,i,u);if(a)switch(a.action){case"seekForward":l.seekForward(a.params.seconds);break;case"setSpeed":l.setSpeed(a.params.speed);break;case"fullscreenToggle":l.fullscreenToggle();break;case"pauseOrPlay":l.pauseOrPlay()}requestAnimationFrame(c)}else requestAnimationFrame(c)}else requestAnimationFrame(c)}window.addEventListener("gamepadconnected",function(){console.log("Initializing content script..."),console.log("Starting gamepad input listener..."),c()})})();